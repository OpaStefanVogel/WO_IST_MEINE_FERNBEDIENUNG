<html>
<head>
<title>Plus2.html</title>
<meta charset="utf-8"/>
<style>
  td {text-align:right; min-width:100}
  .yx {background-color:white}
  .xy {background-color:LightGray}
  .xx {background-color:orange}
  .yy {background-color:aqua}
  </style>
<script>
var Ausgangsmarix=[];
var gemeinsamer_Nenner=1;
var m=0;
var n=0;
var D=[];
var B=[];
var LCode="";
var HCode="";
var p=[];
var hist=[];
let U=[];
let V=[];
let Yi=[];//war Ui
let Xj=[];//war Vj
let AMERK=[];
let g=0;
let h=0;
let k=0;
let l=0;

function Los() {
  //alert(document.getElementById("input").value);
  eval(document.getElementById("input").value);
  m=Ausgangsmatrix.length;
  n=Ausgangsmatrix[0].length;
  LCode="m="+m+"\nn="+n+";\n";
  D=[]; for (var j=0;j<n;j++) D[j]=j;
  B=[]; for (var i=0;i<m;i++) B[i]=-1-i;
  U=[];
  V=[];
  Yi=[];
  Xj=[];

  hist=[];
  p=[0,0,0,0,0];
  AMERK=structuredClone(Ausgangsmatrix);
  Ausgabe();
  }

function tausche(r,s) {
  //alert("[ ["+Ausgangsmatrix.join("],\n  [")+"] ] / "+gemeinsamer_Nenner);  
  m=Ausgangsmatrix.length;
  n=Ausgangsmatrix[0].length;
  //alert(m+" "+n);
  var neueMatrix=[];
  var neuerNenner=Ausgangsmatrix[r][s];
  for (var i=0;i<m;i++) {
    neueMatrix[i]=[];
    for (var j=0;j<n;j++) {
      if (i==r&&j==s) neueMatrix[i][j]=gemeinsamer_Nenner;
      if (i!=r&&j==s) neueMatrix[i][j]=Ausgangsmatrix[i][j];
      if (i==r&&j!=s) neueMatrix[i][j]=-Ausgangsmatrix[i][j];
      if (i!=r&&j!=s) neueMatrix[i][j]=(Ausgangsmatrix[i][j]*neuerNenner-Ausgangsmatrix[i][s]*Ausgangsmatrix[r][j])/gemeinsamer_Nenner;
      }
    }
  Ausgangsmatrix=neueMatrix;
  gemeinsamer_Nenner=neuerNenner;
  //alert("r="+r+"; s="+s+";\n\n[ ["+Ausgangsmatrix.join("],\n  [")+"] ] / "+gemeinsamer_Nenner);
  }

function alt(bi) { if (bi<0) return n-bi-2; else return bi; }
function neu(bi) { if (bi<n) return bi; else return n-bi-2; }
function xy(bi) { if (bi<n) return "x"+bi; else if (bi<n+m-1) return "y"+(bi-n+1); else return 0;}

function t(r,s) {
  hist.push([r,s]);
  p=[r,s,r,s];
  var merk=B[p[2]];
  B[p[2]]=D[p[3]];
  D[p[3]]=merk;
  tausche(p[2],p[3]);
  V=[]; for (let i=0;i<B.length;i++) if (B[i]>=0) V.push(B[i]); V.sort();
  U=[]; for (let i=0;i<D.length;i++) if (D[i]<0) U.push(-D[i]-1); U.sort();
  Ausgabe();
  }

function Ausgabe() {
  LCode="D=["+D+"];\nB=["+B+"];\np=["+[neu(p[0]),neu(p[1]),p[2],p[3],p[4]]+"];\n"
    +'U=['+U+'];\n'
    +'V=['+V+'];\n'
    +"-------\n"+LCode;
  HCode=Ausgabe_HCode(Ausgangsmatrix,gemeinsamer_Nenner,B,D,p);
  document.getElementById("Logfile").firstChild.nodeValue=LCode;
  document.getElementById("HCode").innerHTML=HCode;
  }

function Ausgabe_Logfile(Ausgangsmatrix,gemeinsamer_Nenner,B,D,p) {
  var T=Ausgangsmatrix.join("],\n  [")+"] ] / "
    +gemeinsamer_Nenner+"\n\nB=["+B+"]; D=["+D+"];"
    +"\n\nr="+p[0]+"; s="+p[1]+"; ri="+p[2]+"; sj="+p[3]+";\n";
  return T;
  }

function Ausgabe_HCode(Ausgangsmatrix,gemeinsamer_Nenner,B,D,p) {
  var T='<table style="font-style:italic;font-size:300%" border="1">\n';
  var Nenner=gemeinsamer_Nenner;
//  if (p[2]>0&&p[3]>0) Nenner=1;
  let determ=det(AUV(U,V));
  let signd=1;
  let signx=1;
  if (determ!=Nenner) signd=-1;
  Yi=U.slice();Xj=V.slice();
  T=T+"<tr>"+"<td>"+Nenner+'<sub><small><small>'+determ+/*'<br/>'+AUV(U,V).join('<br/>')+'<br/>U='+U+'<br/>V='+V+*/"</small></small></sub></td>";
  for (var j=0;j<n;j++) {
      T=T+"<td>";
      if (D[j]>=0) T=T+"x<sub>"+D[j]+"</sub></td>"; 
        else T=T+"y<sub>"+(-1-D[j])+"</sub></td>";
      }
  for (var i=0;i<m;i++) {
    T=T+"<tr>";
    if (B[i]<0) T=T+"<td>y<sub>"+(-1-B[i])+"</sub></td>"; 
      else T=T+"<td>x<sub>"+(B[i])+"</sub></td>";
    for (var j=0;j<n;j++) {
      signx=1;
      if (i==p[2]&&j==p[3]) T=T+'<td style="color:blue; border:solid"';
        else T=T+"<td";Yi=U.slice();Xj=V.slice();
      if (B[i]<0&&D[j]>=0) {
        T=T+' class="yx"';
        k=-1-B[i]; l=D[j];
        Xj.push(l); Xj.sort();
        Yi.push(k); Yi.sort();
        signx=(-1)**(Yi.indexOf(k)+Xj.indexOf(l));
        }
      if (B[i]>=0&&D[j]>=0) {
        T=T+' class="xx"';
        h=B[i]; l=D[j];
        Xj=[]; for(let p=0;p<V.length;p++) if (V[p]!=h) Xj.push(V[p]); Xj.push(l); Xj.sort();
        signx=(-1)**(Xj.indexOf(l)+V.indexOf(h))*(-1);
        }
      if (B[i]<0&&D[j]<0) {
        T=T+' class="yy"';
        k=-1-B[i]; g=-1-D[j];
        Yi=[]; for(let p=0;p<U.length;p++) if (U[p]!=g) Yi.push(U[p]); Yi.push(k); Yi.sort();
        signx=(-1)**(Yi.indexOf(k)+U.indexOf(g));
        }
      if (B[i]>=0&&D[j]<0) {
        T=T+' class="xy"';
        h=B[i]; g=-1-D[j];
        Yi=[]; for(let p=0;p<U.length;p++) if (U[p]!=g) Yi.push(U[p]);
        Xj=[]; for(let p=0;p<V.length;p++) if (V[p]!=h) Xj.push(V[p]);
        signx=(-1)**(V.indexOf(h)+U.indexOf(g));
        }
      determ=signd*signx*det(AUV(Yi,Xj));
      if (determ!=Ausgangsmatrix[i][j]) T=T+' style="border:solid red 5px"';
      T=T+' onclick="t('+i+","+j+')">';
      if (Ausgangsmatrix[i][j]>=0) T=T+"+";
      T=T+(Ausgangsmatrix[i][j])+/*'<sub><small><small><small>'+determ+'<br/>'+signx+'<br/>'+AUV(Yi,Xj).join('<br/>')+'<br/>Yi='+Yi+'<br/>Xj='+Xj+'</small></small></small></sub>'+*/"</td>";
      }
    T=T+"</tr>";
    }
//  T=T+Ausgangsmatrix.join("],\n  [")+"] ] / "
//    +gemeinsamer_Nenner+"\n\nB=["+B+"]; D=["+D+"];"
//    +"\n\nr="+p[0]+"; s="+p[1]+"; ri="+p[2]+"; sj="+p[3]+";\n";
  T=T+"</table>";
  //alert(T);
  return T;
  }
/*
  y3 y1 y2 y5
x1
x3
x5
x6
*/
  </script>

<script>
function AUV(Yi,Xj) {
  let RET='';
  let M=[];
  for (let k=0;k<Yi.length;k++) {
    let Mi=[];
    for (let l=0;l<Xj.length;l++) Mi.push(AMERK[Yi[k]][Xj[l]]);
    M.push(Mi);
    }
  return M;
  }
  </script>

<script>
function det(Ausgangsmatrix) {
  let gemeinsamer_Nenner=1;
  //alert("[ ["+Ausgangsmatrix.join("],\n  [")+"] ] / "+gemeinsamer_Nenner);
  let m=Ausgangsmatrix.length;
  if (m==0) return 1;
//  return Math.round(determinantOfMatrixIterative(Ausgangsmatrix,m));
  return Math.round(determinantOfMatrixRecursive(Ausgangsmatrix,m));
  let n=Ausgangsmatrix[0].length;
  //alert(m+" "+n);
for (let r=0;r<m;r++) {let s=r;
  var neueMatrix=[];
  var neuerNenner=Ausgangsmatrix[r][s];
  for (var i=0;i<m;i++) {
    neueMatrix[i]=[];
    for (var j=0;j<n;j++) {
      if (i==r&&j==s) neueMatrix[i][j]=gemeinsamer_Nenner;
      if (i!=r&&j==s) neueMatrix[i][j]=Ausgangsmatrix[i][j];
      if (i==r&&j!=s) neueMatrix[i][j]=-Ausgangsmatrix[i][j];
      if (i!=r&&j!=s) neueMatrix[i][j]=(Ausgangsmatrix[i][j]*neuerNenner-Ausgangsmatrix[i][s]*Ausgangsmatrix[r][j])/gemeinsamer_Nenner;
      }
    }
//  if (neuerNenner<0) {
//    for (var i=0;i<m;i++) for (var j=0;j<n;j++) neueMatrix[i][j]=-neueMatrix[i][j];
//    neuerNenner=-neuerNenner;
//    }
  Ausgangsmatrix=neueMatrix;
  gemeinsamer_Nenner=neuerNenner;
  //alert("r="+r+"; s="+s+";\n\n[ ["+Ausgangsmatrix.join("],\n  [")+"] ] / "+gemeinsamer_Nenner);
  }
  return gemeinsamer_Nenner;
  }
  </script>

<script>//https://www.geeksforgeeks.org/javascript-program-to-find-the-determinant-of-a-matrix/

// N is the order of the matrix
const N = 3;
function determinantOfMatrixRecursive(mat, n) {
	if (n === 1) {
		return mat[0][0];
	}
	let det = 0;
	let sign = 1;
	for (let i = 0; i < n; i++) {
		let submatrix = 
			createSubmatrix(mat, i, n);
		det += sign * mat[0][i] * 
			determinantOfMatrixRecursive(submatrix, n - 1);
		sign = -sign;
	}
	return det;
}

// Function to find sub-matrices of different orders
function createSubmatrix(mat, colToRemove, n) {
	let submatrix = [];
	for (let i = 1; i < n; i++) {
		let newRow = [];
		for (let j = 0; j < n; j++) {
			if (j !== colToRemove) {
				newRow.push(mat[i][j]);
			}
		}
		submatrix.push(newRow);
	}
	return submatrix;
}

let mat2 = [
	[0, 4, -1],
	[0, 0, -2],
	[1, 2, -1]
];

//console.log(
//	"Determinant of the matrix is : ",
//	determinantOfMatrixRecursive(mat2, N)
//);
//alert(determinantOfMatrixRecursive(mat2, N));

function determinantOfMatrixIterative(mat, n) {
	let det = 1;
	let total = 1;
	const temp = Array(n).fill(0);
	for (let i = 0; i < n; i++) {
		let index = i;
		while (index < n && mat[index][i] === 0) {
			index++;
		}
		if (index === n) {
			continue;
		}
		if (index !== i) {
			for (let j = 0; j < n; j++) {
				[mat[i][j], mat[index][j]] = 
				[mat[index][j], mat[i][j]];
			}
			det *= Math.pow(-1, index - i);
		}
		for (let j = 0; j < n; j++) {
			temp[j] = mat[i][j];
		}
		for (let j = i + 1; j < n; j++) {
			const num1 = temp[i];
			const num2 = mat[j][i];
			for (let k = 0; k < n; k++) {
				mat[j][k] = 
					num1 * mat[j][k] - 
					num2 * temp[k];
			}
			total *= num1;
		}
	}
	for (let i = 0; i < n; i++) {
		det *= mat[i][i];
	}
	return det / total;
}

const mat = [
	[8, 1, 2],
	[2, 1, 4],
	[1, 0, 5]
];
//console.log(
//	"Determinant of the matrix is:", 
//	determinantOfMatrixIterative(mat, N));


//alert(determinantOfMatrixIterative(mat, N));

/*
alert(determinantOfMatrixIterative([[-1,1,-2,5],[-2,2,4,-8],[-2,2,6,-8],[-4,1,-2,6]],4)==-108);
alert(determinantOfMatrixRecursive([[-1,1,-2,5],[-2,2,4,-8],[-2,2,6,-8],[-4,1,-2,6]],4)==108);
*/	


  </script>
<body onload="Los()">
<p>Ein Programm zu <a href="https:" target="_blank">???</a></p>

<div>Input <i>(javascript, "." als Dezimaltrenner)</i>:</div>
<textarea id="input" cols="80" rows="10" >Ausgangsmatrix=[ 
  [  4, -1,  0,  0,  0,  0,  0, -1 ],
  [ -1,  4, -1,  0,  0,  0,  0,  0 ],
  [  0, -1,  4, -1,  0,  0,  0,  0 ],
  [  0,  0, -1,  4, -1,  0,  0,  0 ],
  [  0,  0,  0, -1,  4, -1,  0,  0 ],
  [  0,  0,  0,  0, -1,  4, -1,  0 ],
  [  0,  0,  0,  0,  0, -1,  4, -1 ],
  [ -1,  0,  0,  0,  0,  0, -1,  4 ] 
  ];

gemeinsamer_Nenner=1;

Ausgangsmatrix2=[ 

  [  1,  2,  4,  1,  1 ],
  [  4, -1, -3,  0, -1 ],
  [  3, -2, -1,  0,  0 ],
  [  3,  0, -1, -4, -1 ] ] ;

Ausgangsmatrix=[ 
  [  1,  2,  4,  1,  1,  4,  3,  7,  8 ],
  [  4, -1, -3,  1, -1, -2,  5,  1,  9 ],
  [  3, -2, -1,  2,  4,  4, -8, -1,  7 ],
  [  2,  2,  4,  5,  1,  4,  3,  5,  8 ],
  [  4, -4, -3,  1, -2, -2,  7,  1,  7 ],
  [  3, -2, -3,  2,  3,  6, -8, -1,  2 ],
  [  1, -4, -2,  1, -3, -2,  6,  1,  8 ],
  [  3, -1, -3,  4,  3,  5, -8, -7,  2 ],
  [  3,  2, -1, -4, -1,  6,  2,  5,  2 ] ] ;

Ausgangsmatrix3=[ 
[-1,1,-2,5],
[-2,2,4,-8],
[-2,2,6,-8],
[-4,1,-2,6]];

/*
  y3 y1 y2 y5
x1
x3
x5
x6
*/
/*
tausche(0,0);
alert(Ausgangsmatrix.join("\n"));
tausche(1,1);
alert(Ausgangsmatrix.join("\n"));
tausche(0,0);
alert(Ausgangsmatrix.join("\n"));
tausche(1,1);
alert(Ausgangsmatrix.join("\n"));
//tausche(1,2);
//tausche(2,2);


//tausche(1,1);
//tausche(2,2);
//tausche(3,3);
//tausche(4,1);
//tausche(2,2);
//tausche(4,2);

starte_Pivotverfahren();
//Zusatz(1,1);
*/
</textarea>
<button onclick="Los()">losrechnen</button>
<button onclick="t(p[2],p[3])">weiter</button>
<button onclick="for (var w=0;w<100;w++) if (p[2]>0 & p[3]>0) t(p[2],p[3])">100*weiter</button>
<button onclick="p=hist.pop(); t(p[0],p[1]); hist.pop()">zurueck</button>

<style>
table {display:table; font-family:Courier Monospace; font-style:italic; font-size:100%; overflow:auto; color:gray; border:double}
tbod {}
sub {white-space:nowrap}
sup {white-space:nowrap}
mat,.mat,det,.det {font-family:Courier Monospace; font-style:italic; display:inline-flex; align-items:center; padding:3px; border-radius:0px; margin:0px; white-space:nowrap; width:min-content; color:gray}
det,.det {border-left:solid 1px; border-right:solid 1px}
det:before {content:""}
co {display:inline-flex; flex-direction:column; font-size:100%; line-height:100%}
su {font-size:75%}
sub {font-size:75%}
sup {padding-left:2px; font-size:75%} /* wegen dem kursiven f<sup>g</sup>*/ 
var {font-family:Courier Monospace; font-style:italic; font-size:100%; color:gray; white-space:pre}
</style>
<div style='display:flex; flex-direvtion:row; overflow:;'><div id="HCode"> </div></div>
<div id="Logfile" style="white-space:pre; font-family:Courier,Monospace; font-size:70%">
  <div>
<div id="Ausgabe">
  <div>
  </body>
  </html>
