<html>
<head>
<title>Lademeter</title>
<meta charset="utf-8"/>
<style>
  </style>
<script>7
function onButtonClick() {
  let filters = [];


  let filterService = document.querySelector('#service').value;
  if (filterService&&filterService.startsWith('0x')) {
    filterService = parseInt(filterService);
  }
  if (filterService) {
    filters.push({services: [filterService]});
  }

  let filterName = document.querySelector('#name').value;
  if (filterName) {
    filters.push({name: filterName});
  }

  let filterNamePrefix = document.querySelector('#namePrefix').value;
  if (filterNamePrefix) {
    filters.push({namePrefix: filterNamePrefix});
  }

  let options = {};
  if (document.querySelector('#allDevices').checked) {
    options.acceptAllDevices = true;
  } else {
    options.filters = filters;
  }
//alert(options);
  alert('Requesting Bluetooth Device...');
  alert('with ' + JSON.stringify(options));
  navigator.bluetooth.requestDevice(options)
  .then(device => {
    alert('> Name:             ' + device.name);
    alert('> Id:               ' + device.id);
    alert('> Connected:        ' + device.gatt.connected);
  })
  .catch(error => {
    alert('Argh! ' + error);
  });
}


function onButtonClick() {
  alert('Requesting Bluetooth Device...');
  navigator.bluetooth.requestDevice(
    {filters: [{services: ['0000fff0-0000-1000-8000-00805f9b34fb']}], optionalServices: ['00001800-0000-1000-8000-00805f9b34fb']})
//    {acceptAllDevices:true, optionalServices: ['00001800-0000-1000-8000-00805f9b34fb'] })
  .then(device => {
    alert('Connecting to GATT Server...');
    return device.gatt.connect();
  })
  .then(server => {
    alert('Getting Battery Service...');
    return server.getPrimaryService('00001800-0000-1000-8000-00805f9b34fb');
  })
  .then(service => {
    alert('Getting Battery Level Characteristic...');
    return service.getCharacteristic('00002a00-0000-1000-8000-00805f9b34fb');
  })
  .then(characteristic => {
    alert('Reading Battery Level...');
    return characteristic.readValue();
  })
  .then(value => {
    let batteryLevel = value.getUint8(0)+" "+value.getUint8(1)+" "+value.getUint8(2);
//    alert('> Battery Level is ' + value + '%');
    alert('> Battery Level is ' + batteryLevel + '%');
  })
  .catch(error => {
    alert('Argh! ' + error);
  });
}
</script>
</head>
<body>
<button onclick="onButtonClick()">click</button> <input id="service" value=""/> <input id="name" value=""/> <input id="namePrefix" value=""/> <input type="checkbox" checked="checked" id="allDevices" value=""/>all Devices
   </body>
   </html>
