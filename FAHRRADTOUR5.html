<!DOCTYPE html>
<html></head><meta charset="utf-8"/><title>Fahrplan</title>
<style>
#graph {
  background-image: url("../../Screenshot_20220101-195407_Maps.jpg");
  }
#Track {
  transform:translate3d(0px,0px,0px);
  
  }
  </style>
</head>
<body onload='getLocation();Trackplot();Gipfel();Sprich("Es kann losgehen");'>
<button onclick='Sprich("Es geht los")'>Los</button>
<button onclick='bisherige_Distanzmarkierung=-1;bisheriger_Gipfel=-1;showPosition(position_merk)'>nächster Gipfel</button>
<div>50.84 12.88 Altendorf<div>
<div>50.71 12.76 Stollberg<div>
<div>50.25520490,12.28000737 Raun</div>
<p id="demo"> </p>
<div>nahestgelegener Trackpunkt <span id="nahestgelegener_Trackpunkt"> </span>
<div id="Gipfel" style="white-space:pre-wrap; font-family:monospace; font.size:80%">Gipfel</div>
<div id="TV" style="display:flex; max-height:200px; overflow:auto; white-space:pre"> </div>
<svg id="graph" width="100%" height="2200" stroke="blue" style="border:solid">
  <g>
  <!--image href="../../Screenshot_20220101-195407_Maps.jpg" width="100%" height="100%" x="800"/-->
  </g>
  <line x1="0" y1="0" x2="100" y2="100" stroke="red"/>
  <path style="transform:translate(100,0)" id="Track" d="M600,200 L500,300 400,200" fill="none"/>
  </svg>
<script>
var x = document.getElementById("demo");
var graph=document.getElementById("graph");

function getLocation() {
    if (navigator.geolocation) {//alert(navigator.geolocation.watchPosition);
        navigator.geolocation.watchPosition(showPosition);
    } else { 
        x.innerHTML = "Geolocation is not supported by this browser.";}
    }

function xyrech(lat,lon) {
  return [965+(lon-12.88)*1498,-(lat-50.84)*2395+305];
  }

function dist(x1,y1,x2,y2) { return Math.sqrt((x1-x2)**2+(y1-y2)**2)*110/2270 }

var nahestgelegener_Trackpunkt=0;
var bisherige_Distanzmarkierung=-1;
var alte_Distanzmarkierung=-1;
var bisheriger_Gipfel=-1;
var Geschwindigkeit=0;
var Richtung=0;
var position_merk=0;
var pause=0;
var imin=[0,0];
var Verfahren=0;

function showPosition(position) {
    position_merk=position;
    x.innerHTML="Latitude: " + position.coords.latitude + 
    "<br>Longitude: " + position.coords.longitude+
    "<br>Speed: " + position.coords.speed + 
    "<br>Altitude: " + position.coords.altitude + 
    "<br>Heading: " + position.coords.heading + 
    "<br>Timestamp: " + new Date(position.timestamp).toTimeString();
    var next=graph.firstElementChild.cloneNode(true);
    var xy=xyrech(position.coords.latitude,position.coords.longitude); //alert(xy);
    next.setAttribute("y2",xy[1]);
    next.setAttribute("x2",xy[0]);
    graph.appendChild(next);
    imin=mindist(xy[0],xy[1],TV);
    if (Verfahren==0&&imin[1]>0.04) {Sprich("Hallo Stefan, du bist vom rechten Weg abgekommen."); Verfahren=1}
    if (Verfahren==1&&imin[1]<0.04) {Sprich("Hallo Stefan, du bist wieder auf dem richtigen Weg."); Verfahren=0}
    var neue_Distanzmarkierung=TV[imin[0]][11];
    if (neue_Distanzmarkierung!=bisherige_Distanzmarkierung&&neue_Distanzmarkierung!=alte_Distanzmarkierung) {
      alte_Distanzmarkierung=bisherige_Distanzmarkierung;
      bisherige_Distanzmarkierung=neue_Distanzmarkierung;
      Geschwindigkeit=Math.floor(position.coords.speed*3.6);
      Richtung=Math.floor(position.coords.heading);
      Sprich("Geschafft "+neue_Distanzmarkierung+", schnell "+Geschwindigkeit+", Höhe"+Math.floor(position.coords.altitude-46.0)+", "+Vorsprung()+". ");
      var gipf=imin[0]+1; //Rückzu -1
      while (!TV[gipf][16]) gipf=gipf+1; //Rückzu -1
      if (neue_Distanzmarkierung==Math.floor(neue_Distanzmarkierung)||gipf!=bisheriger_Gipfel) {
        bisheriger_Gipfel=gipf;
        var dat=new Date();
        Sprich("Nächster Berggipfel "+TV[gipf][16]+", bei Höhe "+(TV[gipf][5])+", und Kilometer "+(TV[gipf][11])+", in "+Math.floor((Date.parse(TV[gipf][1])-Date.parse(TV[imin[0]][1]))/1000/60)+" Minuten. Uhrzeit "+dat.getHours()+" Uhr "+dat.getMinutes()+".");
        }
      if (pause!=0) clearTimeout(pause);
      pause=setTimeout(Pausenfunktion,60000);
      }
    document.getElementById("nahestgelegener_Trackpunkt").firstChild.nodeValue=imin+" "+TV[imin[0]][0]+" "+neue_Distanzmarkierung;
}

function Vorsprung() {
  var ret="";
  var dat1=Date.now();
  var dat2=Date.parse(TV[imin[0]][1]);
  var diff=((dat2-dat1)%(60*60*1000))/1000;
  if (diff<0) diff=diff+3600;
  if (diff<30*60) ret=ret+"eher, "; else {diff=60*60-diff; ret=ret+"später, "}
  var minu=Math.floor(diff/60);
  var seku=Math.floor(diff-60*minu);
  ret=ret+" "+minu+" zu "+seku;
  return ret; 
  }

function Pausenfunktion() {
  var dat1=Date.now();
  var dat2=Date.parse(TV[imin[0]][1]);
  //alert((dat2-dat1)%(24*60*60*1000));
  Sprich(Vorsprung());
  if (Verfahren==1) Sprich("irgendwie Verfahren");
  pause=setTimeout(Pausenfunktion,60000);
  }
</script>

<script>
function Sprich(was) {
  var worte = new SpeechSynthesisUtterance(was);
  worte.lang = "de-DE";
  window.speechSynthesis.speak(worte);
  }

//alert(8);
//Sprich("Es kann losgehen");
  </script>

<script src="../../Track_Raun_ueber_Wohlhausen.js" type="text/javascript"></script>
<script src="../../Track_Schoeneck_plus_Wohlhausen.js" type="text/javascript"></script>
<script src="../../Track_Raun_zurueck_ueber_Leubetha.js" type="text/javascript"></script>
<script>
//alert(Track_Raun_zurueck_ueber_Leubetha);
//alert(Track_Raun_ueber_Wohlhausen);
//alert(Track_Schoeneck_plus_Wohlhausen);
var TV=[];
var Track=eval(document.documentURI.split("?")[1].split(".")[0]);
function Trackplot() {
  //alert(Track.join("\n"));
  //alert(Track[9]);
  for (var i=9;i<Track.length;i++) {
    var T=[];
    var S=Track[i].split(",");
    //alert(i+"\n"+S.join("\n"));
    T[2]=S[2]*1.0;
    T[3]=S[3]*1.0;
    T[5]=Math.floor(S[5]*1.0);
    T[16]=S[12];
    T[1]=S[1];
    //alert("T=["+T+"]");
    TV.push(T);
    }
  
  //alert(TV.join("\n"));
  //alert(TV.length);
  for (var i=0;i<TV.length;i++) {
    var xy=xyrech(TV[i][2],TV[i][3]);
    TV[i][12]=xy[0];
    TV[i][13]=xy[1];
    }
  //alert(TV.join("\n"));
  //Summe
  var sum=0;
  TV[0][0]=0;
  for (var i=1;i<TV.length;i++) {
    var ti=TV[i];
    sum=sum+dist(TV[i-1][12],TV[i-1][13],ti[12],ti[13]);
    if (ti[16]&&ti[16].slice(0,3)=="GPS") sum=0;
    ti[0]=sum;
    }
  //alert(sum);
  //alert(TV.join("\n"));
  var Kilometer_0=0;
  if (TV[TV.length-1][16]=="Kilometer 0") Kilometer_0=TV[TV.length-1][0].toFixed(1);
  for (var i=0;i<TV.length;i++) {
    var ti=TV[i];
    ti[10]=Math.floor(ti[0]);
    if (Kilometer_0!=0) ti[11]=(Kilometer_0-ti[0]).toFixed(1); else ti[11]=ti[0].toFixed(1); 
    }
  //alert(TV.slice(0).join("\n"));
  document.getElementById("TV").firstChild.nodeValue=TV.slice(0,-1).join("\n");
  var d="M"+TV[0][12]+","+(TV[0][13]-0)+" L";
  for (var i=1;i<TV.length;i++) {
    d=d+" "+TV[i][12]+","+TV[i][13];
    if (TV[i][10]!=TV[i-1][10]) d=d+"h 6 h -6 L";
    }
  //alert(d);
  document.getElementById("Track").setAttribute("d",d);
  }

function mindist(x1,y1,TV) {
  var min=100000000;
  var imin=0;
  for (var i=0;i<TV.length;i++) {
    var dis=dist(x1,y1,TV[i][12],TV[i][13]);
    if (dis<min) {min=dis; imin=i}
    }
  return [imin,min];
  }

function Gipfel() {
  var gipf=[];
  for (var i=0;i<TV.length;i++) {
    if (TV[i][16]) gipf.push([TV[i][1].slice(11)+"     "+TV[i][5]+"     "+TV[i][11]+"   "+TV[i][16]]);
    }
  document.getElementById("Gipfel").firstChild.nodeValue=gipf.join("\n");
  }

  </script>
</body>
</html>
