<html>
<head>
<title>Lademeter</title>
<meta charset="utf-8"/>
<style>
  </style>
<script>
var Ladebreite=6.5;
var LM=1;

var Ladung=[
1,1.1,1.2,1.3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
];

var Resultat=[];

function Abstand(P,Q) {return Math.sqrt((P[0]-Q[0])*(P[0]-Q[0])+(P[1]-Q[1])*(P[1]-Q[1]))}

function Dreieck(P,Pr,Q,Qr,Rr) {
  var ww=Math.acos((Abstand(P,Q)*Abstand(P,Q)+(Pr+Rr)*(Pr+Rr)/4-(Qr+Rr)*(Qr+Rr)/4)/(2*Abstand(P,Q)*(Pr+Rr)/2));
  var xk=P[0]+(Pr+Rr)/2*(Math.cos(ww)*(Q[0]-P[0])-Math.sin(ww)*(Q[1]-P[1]))/(Abstand(P,Q));
  var yk=P[1]+(Pr+Rr)/2*(Math.sin(ww)*(Q[0]-P[0])+Math.cos(ww)*(Q[1]-P[1]))/(Abstand(P,Q));
  return [xk,yk];
  }

function Lademeter() {
  LM=0;
  var R=[Ladung[0]/2,Ladung[0]/2];
  var Anfangsindex=0;
  do {
    Resultat.push(R);
    Anfangsindex=Anfangsindex+1;
    R=[Ladung[Anfangsindex]/2,R[1]+Math.sqrt((Ladung[Anfangsindex-1]/2+Ladung[Anfangsindex]/2)*(Ladung[Anfangsindex-1]/2+Ladung[Anfangsindex]/2)-(Ladung[Anfangsindex-1]/2-Ladung[Anfangsindex]/2)*(Ladung[Anfangsindex-1]/2-Ladung[Anfangsindex]/2))];
    } while (R[1]+Ladung[Anfangsindex]/2<Ladebreite-Ladung[Anfangsindex+1]);
  R=[Ladung[Anfangsindex+1]/2,Ladebreite-Ladung[Anfangsindex+1]/2];
  Resultat.push(R);
  Anfangsindex=Anfangsindex+1;
    
  
  for(var i=Anfangsindex;i<Ladung.length;i++) {//alert(i);
    var d=Ladung[i];
    var xmin=100000;
    var y=d/2;
    
    for (var j=Math.max(0,Resultat.length-20);j<Resultat.length;j++) {
      for (var k=0;k<Resultat.length;k++) if (j!=k) {
        var a=Abstand(Resultat[j],Resultat[k]);
        //alert(Resultat[j]+" "+Resultat[k]+" "+a);
        if (a<Ladung[j]/2+Ladung[k]/2+d) {
          var R=Dreieck(Resultat[j],Ladung[j],Resultat[k],Ladung[k],d);
          //alert(R);
          var gueltig=true;
          if (R[0]-d/2<0) gueltig=false;
          if (R[1]-d/2<0) gueltig=false;
          if (R[1]+d/2>Ladebreite) gueltig=false;
          for (var l=0;l<Resultat.length;l++) if (l!=j&&l!=k&&Abstand(Resultat[l],R)<Ladung[l]/2+d/2) gueltig=false;
          if (gueltig==true&&R[0]<xmin) {xmin=R[0];y=R[1]}
          //alert(R+" "+gueltig);
          //for (var
          }
        }
      //linker Rand
      if (Resultat[j][1]-Ladung[j]/2<d) {
        //if (i==55&&j==15) alert(i+" "+j+" "+Resultat[j]);
        R=[Resultat[j][0]+Math.sqrt((Ladung[j]/2+d/2)*(Ladung[j]/2+d/2)-(Resultat[j][1]-d/2)*(Resultat[j][1]-d/2)),d/2];
        var gueltig=true;
        for (var l=0;l<Resultat.length;l++) if (l!=j&&Abstand(Resultat[l],R)<Ladung[l]/2+d/2) gueltig=false;
        if (gueltig==true&&R[0]<xmin) {xmin=R[0];y=R[1]}
        }
      //rechter Rand
      //alert(i+" "+j+(Resultat[j][1]+Ladung[j]/2));
      if (Resultat[j][1]+Ladung[j]/2>Ladebreite-d) {
        //alert(i+"."+j+" "+Resultat[j]+" "+(Ladebreite-d));
        R=[Resultat[j][0]+Math.sqrt((Ladung[j]/2+d/2)*(Ladung[j]/2+d/2)-(Ladebreite-Resultat[j][1]-d/2)*(Ladebreite-Resultat[j][1]-d/2)),Ladebreite-d/2];
        //alert(i+" "+j+"\n"+R+"\n"+xmin+" "+y);
        var gueltig=true;
        for (var l=0;l<Resultat.length;l++) if (l!=j&&Abstand(Resultat[l],R)<Ladung[l]/2+d/2) gueltig=false;
        if (gueltig==true&&R[0]<xmin) {xmin=R[0];y=R[1]}
        }
      }
    Resultat.push([xmin,y]);
    if (LM<xmin+d/2) LM=xmin+d/2;
    }  
  document.getElementById("Logfile").firstChild.nodeValue=
    (Resultat[110][0]-Resultat[010][0])+"\n"+
    (Resultat[210][0]-Resultat[110][0])+"\n"+
    LM+"\n"+Resultat.join("\n");
  return LM;
  }

function Ausgabe_SVG() {
  //alert(LM+"\n"+Resultat.join("\n"));
  var dc=document.getElementById("Ladeflaeche");
  for (var i=0;i<Resultat.length;i++) {
    var c=document.createElementNS("http://www.w3.org/2000/svg","circle");
    c.setAttribute("cx",Resultat[i][0]);
    c.setAttribute("cy",Resultat[i][1]);
    c.setAttribute("r",Ladung[i]/2);
    dc.appendChild(document.createTextNode("\n      "));
    dc.appendChild(c);
    var c=document.createElementNS("http://www.w3.org/2000/svg","text");
    c.setAttribute("x",Resultat[i][0]-0.2);
    c.setAttribute("y",Resultat[i][1]+0.1);
    c.appendChild(document.createTextNode((i+1)));
    dc.appendChild(document.createTextNode("\n      "));
    dc.appendChild(c);
    }
  document.getElementById("Ladebreite").firstChild.nodeValue=Math.round(Ladebreite*100)/100;
  document.getElementById("Lademeter").firstChild.nodeValue=Math.round(LM*100)/100;
  document.getElementById("Ladungszahl").firstChild.nodeValue=Ladung.length;
  }

function Zurueck_zum_Anfang() {
  Resultat=[];
  LM=1;
  var LF=document.getElementById('Ladeflaeche');
  while (LF.hasChildNodes()) LF.removeChild(LF.firstChild);
  }

  </script>
<body onload="Lademeter();Ausgabe_SVG()">hallo
<p>
Ladebreite=<span id="Ladebreite"> </span> m.
<button onclick="Ladebreite=Ladebreite+0.1;Zurueck_zum_Anfang();Lademeter();Ausgabe_SVG()">+0.1</button>
<button onclick="Ladebreite=Ladebreite+0.01;Zurueck_zum_Anfang();Lademeter();Ausgabe_SVG()">+0.01</button>
<button onclick="Ladebreite=Ladebreite-0.01;Zurueck_zum_Anfang();Lademeter();Ausgabe_SVG()">-0.01</button>
<button onclick="Ladebreite=Ladebreite-0.1;Zurueck_zum_Anfang();Lademeter();Ausgabe_SVG()">-0.1</button>
Lademeter=<span id="Lademeter"> </span> m für <span id="Ladungszahl"> </span> Fässer.
  </p>
<svg width="800" height="200">
<g id="Ladeflaeche" transform="scale(20)" fill="blue" stroke="black" stroke-width="0.01" font-size="2%">
  <line x1="0" y1="0" x2="30" y2="0"/>
  <line x1="0" y1="3.5" x2="30" y2="3.5"/>
  </g>
  </svg>
<div id="Logfile" style="white-space:pre">
  <div>
  </body>
  </html>
